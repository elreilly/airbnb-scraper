#!python3
import argparse
import datetime
import json
import operator
import re
import sys
import urllib.parse

import dataclasses
import geopy
import requests
from typing import Any, Callable, List, Type

USER_AGENT = "PostmanRuntime/7.26.8"


def get_one_guest_price(room_id, check_in, check_out, api_key):
    response = get_response_from_section(
        room_id, check_in, check_out, 0, ["BOOK_IT_SIDEBAR"], api_key
    )
    value = [
        get_value_from_path(response, aspect.path)
        for aspect in ASPECTS
        if aspect.name == "List Price"
    ]
    return value[0]


def get_response_from_section(
    room_id, check_in, check_out, guests, sections, api_key
):
    req = {
        "request": {
            "id": room_id,
            "layouts": [],
            "sectionIds": sections,
            "checkIn": check_in,
            "checkOut": check_out,
            "adults": guests,
        }
    }

    url = (
        "https://www.airbnb.com/api/v3/PdpPlatformSections"
        "?operationName=PdpPlatformSections&locale=en&currency=USD"
        "&variables={}".format(urllib.parse.quote(json.dumps(req)))
    )

    payload = (
        '{"query":"query PdpPlatformSections($request: MerlinPdpSectionsRequestInput!) {\\n  merlin {\\n    __typename\\n    pdpSections(request: $request) {\\n      __typename\\n      id\\n      sections {\\n        __typename\\n        ...PdpSectionFragments\\n      }\\n      sectionPlacements {\\n        __typename\\n        ...PdpSectionPlacementFragments\\n      }\\n      screens {\\n        __typename\\n        id\\n        name\\n        sectionPlacements {\\n          __typename\\n          placement\\n          layout\\n          sectionDetails {\\n            __typename\\n            sectionId\\n            divider {\\n              __typename\\n              lineStyle\\n              lineWidth\\n            }\\n            border {\\n              __typename\\n              lineStyle\\n              shadow\\n              color\\n              hoverColor\\n              paddingPoints\\n              leftOnly\\n              rightOnly\\n              topRounded\\n              sides\\n              bottomRounded\\n            }\\n            topMarginPoints\\n            topPaddingPoints\\n            bottomPaddingPoints\\n            bottomMarginPoints\\n            backgroundColorNew {\\n              __typename\\n              hex\\n              dls19\\n            }\\n            horizontalPadding\\n            maxWidth\\n          }\\n          style {\\n            __typename\\n            topPaddingPoints\\n            bottomPaddingPoints\\n            border {\\n              __typename\\n              lineStyle\\n              shadow\\n              color\\n              hoverColor\\n              paddingPoints\\n              leftOnly\\n              rightOnly\\n              topRounded\\n              sides\\n              bottomRounded\\n            }\\n            span\\n          }\\n          formFactor\\n        }\\n        screenProperties {\\n          __typename\\n          modalType\\n          transitionType\\n          modalTitle\\n          unstyled\\n        }\\n      }\\n      metadata {\\n        __typename\\n        ...PdpPlatformMetadataFragments\\n      }\\n    }\\n  }\\n}\\n\\nfragment AccessibilityFeaturesSectionFragment on MerlinAccessibilityFeaturesSection {\\n  __typename\\n  title\\n  subtitle\\n  previewAccessibilityFeaturesGroups {\\n    __typename\\n    id\\n    title\\n    accessibilityFeatures {\\n      __typename\\n      id\\n      available\\n      title\\n      image {\\n        __typename\\n        ...PdpImageFragment\\n      }\\n    }\\n  }\\n  seeAllAccessibilityFeaturesGroups {\\n    __typename\\n    id\\n    title\\n    subtitle\\n    accessibilityFeatures {\\n      __typename\\n      id\\n      available\\n      title\\n      subtitle\\n      images {\\n        __typename\\n        ...PdpImageFragment\\n      }\\n    }\\n  }\\n  seeAllAccessibilityFeaturesButton {\\n    __typename\\n    title\\n    loggingEventData {\\n      __typename\\n      ...MerlinLoggingEventData\\n    }\\n  }\\n}\\n\\nfragment AdminBannerSectionFragment on MerlinAdminBannerSection {\\n  __typename\\n  title\\n  subtitle\\n  editButton {\\n    __typename\\n    title\\n    loggingEventData {\\n      __typename\\n      ...MerlinLoggingEventData\\n    }\\n  }\\n}\\n\\nfragment AvailabilityCalendarSectionFragment on MerlinAvailabilityCalendarSection {\\n  __typename\\n  title\\n  subtitle\\n  descriptionItems {\\n    __typename\\n    title\\n  }\\n  listingTitle\\n  discountCopy\\n  priceDisclaimer\\n  localizedLocation\\n  thumbnail {\\n    __typename\\n    ...PdpImageFragment\\n  }\\n  maxGuestCapacity\\n  inlineCalendarLoggingEventData {\\n    __typename\\n    ...CalendarLoggingEventData\\n  }\\n  drawerCalendarLoggingEventData {\\n    __typename\\n    ...CalendarLoggingEventData\\n  }\\n}\\n\\nfragment BookItBarPrice on MerlinBarPrice {\\n  __typename\\n  accessibilityLabel\\n  displayPrices {\\n    __typename\\n    displayRateType\\n    priceString\\n    type\\n  }\\n  explanationData {\\n    __typename\\n    title\\n    subtitle {\\n      __typename\\n      ...BookItBarPriceExplanationDataSubtitle\\n    }\\n    anchorLink\\n    anchorText\\n    priceGroups {\\n      __typename\\n      type\\n      title\\n      subtitle {\\n        __typename\\n        ...BookItBarPriceExplanationDataSubtitle\\n      }\\n      items {\\n        __typename\\n        description\\n        explanationData {\\n          __typename\\n          title\\n          subtitle {\\n            __typename\\n            ...BookItBarPriceExplanationDataSubtitle\\n          }\\n          priceGroups {\\n            __typename\\n            type\\n            items {\\n              __typename\\n              description\\n              priceString\\n              type\\n            }\\n            title\\n            subtitle {\\n              __typename\\n              ...BookItBarPriceExplanationDataSubtitle\\n            }\\n          }\\n          anchorLink\\n          anchorText\\n        }\\n        priceString\\n        type\\n      }\\n    }\\n  }\\n}\\n\\nfragment BookItBarPriceExplanationDataSubtitle on MerlinSubtitle {\\n  __typename\\n  legalDisclaimerSubtitle\\n  discountDisclaimerSubtitle\\n  additionalPropertyChargeDisclaimerTooltip\\n  policyItems {\\n    __typename\\n    anchorLink\\n    anchorText\\n    subtitle\\n    title\\n  }\\n}\\n\\nfragment BookItButtonByPlacement on MerlinBasicListItem {\\n  __typename\\n  title\\n  loggingEventData {\\n    __typename\\n    ...MerlinLoggingEventData\\n  }\\n}\\n\\nfragment BookItCalendarDrawerSectionFragment on MerlinBookItSection {\\n  __typename\\n  ...BookItSectionFragment\\n}\\n\\nfragment BookItCalendarSheetSectionFragment on MerlinBookItSection {\\n  __typename\\n  ...BookItSectionFragment\\n}\\n\\nfragment BookItDisplayRate on MerlinDisplayRate {\\n  __typename\\n  amount\\n  amountMicros\\n  amountFormatted\\n  currency\\n}\\n\\nfragment BookItFloatingFooterSectionFragment on MerlinBookItSection {\\n  __typename\\n  ...BookItSectionFragment\\n}\\n\\nfragment BookItFormattedPriceAmount on MerlinFormattedPriceAmount {\\n  __typename\\n  amountFormatted\\n  priceAmount {\\n    __typename\\n    amount\\n  }\\n}\\n\\nfragment BookItNavSectionFragment on MerlinBookItSection {\\n  __typename\\n  ...BookItSectionFragment\\n}\\n\\nfragment BookItSectionFormattedPriceAmount on MerlinFormattedPriceAmount {\\n  __typename\\n  amountFormatted\\n  priceAmount {\\n    __typename\\n    amount\\n  }\\n}\\n\\nfragment BookItSectionFragment on MerlinBookItSection {\\n  __typename\\n  title\\n  subpageIdToOpen\\n  showPriceBreakdown\\n  cancellationPolicyLoggingEventData {\\n    __typename\\n    ...MerlinLoggingEventData\\n  }\\n  bookItPlacement\\n  brandedBadge {\\n    __typename\\n    label\\n    type\\n  }\\n  calendarTitle\\n  calendarSubtitle\\n  descriptionItems {\\n    __typename\\n    title\\n  }\\n  discountCopy\\n  earliestAvailableDatePrompt {\\n    __typename\\n    title\\n    icon\\n    button {\\n      __typename\\n      title\\n      action {\\n        __typename\\n        ... on MerlinOpenAvailabilityCalendarAction {\\n          loggingData {\\n            __typename\\n            ...MerlinLoggingEventData\\n          }\\n          checkIn\\n          scrollToMonth\\n        }\\n      }\\n    }\\n  }\\n  calendarPriceDisclaimer\\n  maxGuestCapacity\\n  tripDetailsLoggingEventData {\\n    __typename\\n    ...CalendarLoggingEventData\\n  }\\n  reviewItem {\\n    __typename\\n    title\\n    subtitle\\n    icon\\n    accessibilityLabel\\n    scrollId\\n  }\\n  available\\n  barPrice {\\n    __typename\\n    ...BookItBarPrice\\n  }\\n  discountData {\\n    __typename\\n    tieredPricingDiscountData {\\n      __typename\\n      totalWithDiscount {\\n        __typename\\n        ...BookItSectionFormattedPriceAmount\\n      }\\n      totalWithoutDiscount {\\n        __typename\\n        ...BookItSectionFormattedPriceAmount\\n      }\\n      savedAmount {\\n        __typename\\n        ...BookItSectionFormattedPriceAmount\\n      }\\n      savedPercentage\\n    }\\n  }\\n  bookItButtonByPlacement {\\n    __typename\\n    defaultText\\n    drawerButton {\\n      __typename\\n      ...BookItButtonByPlacement\\n    }\\n    footerButton {\\n      __typename\\n      ...BookItButtonByPlacement\\n    }\\n    sideBarButton {\\n      __typename\\n      ...BookItButtonByPlacement\\n    }\\n    stickyNavButton {\\n      __typename\\n      ...BookItButtonByPlacement\\n    }\\n    calendarFooterButton {\\n      __typename\\n      ...BookItButtonByPlacement\\n    }\\n    roomRateButton {\\n      __typename\\n      ...BookItButtonByPlacement\\n    }\\n  }\\n  cancellationPolicies {\\n    __typename\\n    cancellationPolicyId: id\\n    cancellationPolicyPriceType\\n    localizedCancellationPolicyName\\n    bookItModuleTooltip\\n  }\\n  cancellationPolicyForDisplay {\\n    __typename\\n    cancellationPolicyPriceType\\n  }\\n  localizedUnavailabilityMessage\\n  localizedUnavailabilityMessagePositionString\\n  priceDisclaimer\\n  shouldDefaultBizToggleForCovid19\\n  shareSave {\\n    __typename\\n    ...MerlinShareSaveFragment\\n  }\\n}\\n\\nfragment BookItSidebarSectionFragment on MerlinBookItSection {\\n  __typename\\n  ...BookItSectionFragment\\n}\\n\\nfragment CalendarLoggingEventData on MerlinCalendarLoggingEventData {\\n  __typename\\n  selectDateLoggingEventData {\\n    __typename\\n    ...MerlinLoggingEventData\\n  }\\n  previousMonthLoggingEventData {\\n    __typename\\n    ...MerlinLoggingEventData\\n  }\\n  nextMonthLoggingEventData {\\n    __typename\\n    ...MerlinLoggingEventData\\n  }\\n  clearDatesButton {\\n    __typename\\n    title\\n    loggingEventData {\\n      __typename\\n      ...MerlinLoggingEventData\\n    }\\n  }\\n  checkInDateInputLoggingEventData {\\n    __typename\\n    ...MerlinLoggingEventData\\n  }\\n  checkOutDateInputLoggingEventData {\\n    __typename\\n    ...MerlinLoggingEventData\\n  }\\n  datesInputLoggingEventData {\\n    __typename\\n    ...MerlinLoggingEventData\\n  }\\n  guestInputLoggingEventData {\\n    __typename\\n    ...MerlinLoggingEventData\\n  }\\n  cancellationPolicyLoggingEventData {\\n    __typename\\n    ...MerlinLoggingEventData\\n  }\\n  saveDatesButton {\\n    __typename\\n    title\\n    loggingEventData {\\n      __typename\\n      ...MerlinLoggingEventData\\n    }\\n  }\\n  changeDatesButtonLoggingEventData {\\n    __typename\\n    ...MerlinLoggingEventData\\n  }\\n  selectCheckOutOnlyDateLoggingEventData {\\n    __typename\\n    ...MerlinLoggingEventData\\n  }\\n  selectMaxNightsViolationDateLoggingEventData {\\n    __typename\\n    ...MerlinLoggingEventData\\n  }\\n  selectMinNightsViolationDateLoggingEventData {\\n    __typename\\n    ...MerlinLoggingEventData\\n  }\\n  selectUnavailableForCheckInDateLoggingEventData {\\n    __typename\\n    ...MerlinLoggingEventData\\n  }\\n  selectUnavailableForCheckoutDateLoggingEventData {\\n    __typename\\n    ...MerlinLoggingEventData\\n  }\\n}\\n\\nfragment ChinaBookItSectionDisplayPriceLineItem on MerlinDisplayPriceLineItem {\\n  __typename\\n  type\\n  total {\\n    __typename\\n    amount\\n    amount_micros: amountMicros\\n    amount_formatted: amountFormatted\\n    is_micros_accuracy: isMicrosAccuracy\\n    currency\\n  }\\n  localized_title: localizedTitle\\n  localized_explanation: localizedExplanation\\n  extra_data: extraData\\n}\\n\\nfragment ChinaBookItSectionFormattedPriceAmount on MerlinFormattedPriceAmount {\\n  __typename\\n  price_amount: priceAmount {\\n    __typename\\n    amount\\n    currency\\n    micros_amount: microsAmount\\n  }\\n  amount_formatted: amountFormatted\\n}\\n\\nfragment ChinaTranslationButton on MerlinTranslationButtonContent {\\n  __typename\\n  originalCtaContent\\n  originalDisclaimer\\n  translatedCtaContent\\n  translatedDisclaimer\\n  loggingEventData {\\n    __typename\\n    ...MerlinLoggingEventData\\n  }\\n  descriptionLanguage\\n  authorType\\n}\\n\\nfragment ClientSeoTagsFragment on MerlinSeoFeatures {\\n  __typename\\n  androidAlternateUrl\\n  androidDeeplink\\n  canonicalUrl\\n  iphoneDeeplink\\n  metaDescription\\n  title\\n  breadcrumbDetails {\\n    __typename\\n    linkRoute\\n    linkText\\n    searchText\\n  }\\n  nearbyCities {\\n    __typename\\n    canonicalLocation\\n    displayLocation\\n    isVr\\n  }\\n  neighborhoodBreadcrumbDetails {\\n    __typename\\n    linkRoute\\n    linkText\\n    searchText\\n  }\\n  ogTags {\\n    __typename\\n    ogDescription\\n    ogImage\\n    ogTitle\\n    ogType\\n    ogUrl\\n    ogImageHeight\\n    ogImageWidth\\n  }\\n  otherPropertyTypes {\\n    __typename\\n    id\\n    option\\n    url\\n  }\\n  propertySearchUrl\\n  relImageSrc\\n  twitterTags {\\n    __typename\\n    twitterCard\\n    twitterDescription\\n    twitterImage\\n    twitterTitle\\n    twitterUrl\\n  }\\n  indexInSearchEngines\\n}\\n\\nfragment ContactTripDesignerSectionFragment on MerlinContactTripDesignerSection {\\n  __typename\\n  subtitle\\n  title\\n  barPrice {\\n    __typename\\n    ...BookItBarPrice\\n  }\\n  guestDetails {\\n    __typename\\n    numberOfAdults\\n    numberOfChildren\\n    numberOfInfants\\n  }\\n  heroMedia {\\n    __typename\\n    landscapePicture {\\n      __typename\\n      baseUrl\\n      orientation\\n      previewEncodedPng\\n      id\\n    }\\n    portraitPicture {\\n      __typename\\n      baseUrl\\n      orientation\\n      previewEncodedPng\\n      id\\n    }\\n  }\\n  overviewItems {\\n    __typename\\n    title\\n    anchor\\n    loggingEventData {\\n      __typename\\n      ...MerlinLoggingEventData\\n    }\\n  }\\n  contactDesignerButton {\\n    __typename\\n    title\\n    anchor\\n    loggingEventData {\\n      __typename\\n      ...MerlinLoggingEventData\\n    }\\n  }\\n}\\n\\nfragment CrossSellSectionFragment on MerlinCrossSellSection {\\n  __typename\\n  title\\n  listingCardLoggingEventData {\\n    __typename\\n    ...MerlinLoggingEventData\\n  }\\n  listingSaveLoggingEventData {\\n    __typename\\n    ...MerlinLoggingEventData\\n  }\\n  listingsNavigationPreviousLoggingEventData {\\n    __typename\\n    ...MerlinLoggingEventData\\n  }\\n  listingsNavigationNextLoggingEventData {\\n    __typename\\n    ...MerlinLoggingEventData\\n  }\\n  experienceCardLoggingEventData {\\n    __typename\\n    ...MerlinLoggingEventData\\n  }\\n  experienceSaveLoggingEventData {\\n    __typename\\n    ...MerlinLoggingEventData\\n  }\\n  experiencesNavigationPreviousLoggingEventData {\\n    __typename\\n    ...MerlinLoggingEventData\\n  }\\n  experiencesNavigationNextLoggingEventData {\\n    __typename\\n    ...MerlinLoggingEventData\\n  }\\n}\\n\\nfragment DescriptionSectionFragment on MerlinDescriptionSection {\\n  __typename\\n  contactHostButton {\\n    __typename\\n    title\\n    loggingEventData {\\n      __typename\\n      ...MerlinLoggingEventData\\n    }\\n  }\\n  hostQuote {\\n    __typename\\n    quote {\\n      __typename\\n      ...ReadMoreHtml\\n    }\\n    signature\\n  }\\n  htmlDescription {\\n    __typename\\n    ...ReadMoreHtml\\n  }\\n  ugcTranslationButton {\\n    __typename\\n    ...UgcTranslationButton\\n  }\\n  showMoreDescriptionButton {\\n    __typename\\n    title\\n    loggingEventData {\\n      __typename\\n      ...MerlinLoggingEventData\\n    }\\n  }\\n  expandedDescriptionTitle\\n  directInteract {\\n    __typename\\n    title\\n    subtitle\\n    message\\n    hostId\\n    send\\n    cancel\\n    beta\\n    tripDates\\n    requestDetails\\n    loggingEventData {\\n      __typename\\n      ...MerlinLoggingEventData\\n    }\\n    buttonDescription\\n  }\\n}\\n\\nfragment GeneralListContentSectionFragment on MerlinGeneralListContentSection {\\n  __typename\\n  title\\n  subtitle\\n  items {\\n    __typename\\n    title\\n    subtitle\\n    icon\\n    anchor\\n    image {\\n      __typename\\n      ...PdpImageFragment\\n    }\\n  }\\n}\\n\\nfragment HeroImageFragment on MerlinImage {\\n  __typename\\n  id\\n  baseUrl\\n  previewEncodedPng\\n  orientation\\n  imageMetadata {\\n    __typename\\n    imageType\\n  }\\n}\\n\\nfragment HeroSectionFragment on MerlinHeroSection {\\n  __typename\\n  previewImages {\\n    __typename\\n    ...HeroImageFragment\\n  }\\n  saveButton {\\n    __typename\\n    ...ShareSaveButton\\n  }\\n  unsaveButton {\\n    __typename\\n    ...ShareSaveButton\\n  }\\n  shareButton {\\n    __typename\\n    ...ShareSaveButton\\n  }\\n  previewImageLoggingEventData {\\n    __typename\\n    ...MerlinLoggingEventData\\n  }\\n  seePhotosButton {\\n    __typename\\n    ...SeePhotosButton\\n  }\\n  carouselImageNavigationLoggingEventData {\\n    __typename\\n    ...MerlinLoggingEventData\\n  }\\n}\\n\\nfragment HighlightsSectionFragment on MerlinHighlightsSection {\\n  __typename\\n  highlights {\\n    __typename\\n    title\\n    subtitle\\n    icon\\n    learnMoreButton {\\n      __typename\\n      title\\n      loggingEventData {\\n        __typename\\n        ...MerlinLoggingEventData\\n      }\\n      screenNavigation {\\n        __typename\\n        ... on MerlinBasicScreenNavigation {\\n          screenId\\n        }\\n      }\\n    }\\n  }\\n}\\n\\nfragment HostProfileSectionFragment on MerlinHostProfileSection {\\n  __typename\\n  title\\n  subtitle\\n  additionalHostsTitle\\n  additionalHosts {\\n    __typename\\n    id\\n    name\\n    avatar {\\n      __typename\\n      avatarImage {\\n        __typename\\n        ...PdpImageFragment\\n      }\\n      userId\\n      loggingEventData {\\n        __typename\\n        ...MerlinLoggingEventData\\n      }\\n    }\\n  }\\n  hostAvatar {\\n    __typename\\n    badge\\n    avatarImage {\\n      __typename\\n      ...PdpImageFragment\\n    }\\n    userId\\n    loggingEventData {\\n      __typename\\n      ...MerlinLoggingEventData\\n    }\\n  }\\n  hostTags {\\n    __typename\\n    title\\n    icon\\n  }\\n  hostFeatures {\\n    __typename\\n    title\\n    subtitle\\n  }\\n  hostInfos {\\n    __typename\\n    title\\n    html {\\n      __typename\\n      ...ReadMoreHtml\\n    }\\n  }\\n  hostProfileDescription {\\n    __typename\\n    ...ReadMoreHtml\\n  }\\n  contactHostButton {\\n    __typename\\n    title\\n    loggingEventData {\\n      __typename\\n      ...MerlinLoggingEventData\\n    }\\n  }\\n  disclaimer {\\n    __typename\\n    title\\n    icon\\n  }\\n}\\n\\nfragment HotelDescriptionSectionFragment on MerlinHotelDescriptionSection {\\n  __typename\\n  description\\n  lat\\n  lng\\n  locationButton {\\n    __typename\\n    anchor\\n    icon\\n    image {\\n      __typename\\n      ...PdpImageFragment\\n    }\\n    loggingEventData {\\n      __typename\\n      ...MerlinLoggingEventData\\n    }\\n    subtitle\\n    title\\n  }\\n  ugcTranslationButton {\\n    __typename\\n    ...UgcTranslationButton\\n  }\\n}\\n\\nfragment HotelProfileSectionFragment on MerlinHotelProfileSection {\\n  __typename\\n  title\\n  hostDescription: description {\\n    __typename\\n    ...ReadMoreHtml\\n  }\\n  hostAvatar {\\n    __typename\\n    badge\\n    avatarImage {\\n      __typename\\n      ...PdpImageFragment\\n    }\\n    userId\\n    loggingEventData {\\n      __typename\\n      ...MerlinLoggingEventData\\n    }\\n  }\\n  hostSubtitle\\n  hostTags {\\n    __typename\\n    title\\n    icon\\n  }\\n  hostTitle\\n  hostFeatures {\\n    __typename\\n    title\\n    subtitle\\n  }\\n  hostInfos {\\n    __typename\\n    title\\n    html {\\n      __typename\\n      ...ReadMoreHtml\\n    }\\n  }\\n  contactHostButton {\\n    __typename\\n    title\\n    loggingEventData {\\n      __typename\\n      ...MerlinLoggingEventData\\n    }\\n  }\\n}\\n\\nfragment HotelRoomCardItemFragment on MerlinRoomCardItem {\\n  __typename\\n  id\\n  title\\n  description\\n  images {\\n    __typename\\n    previewEncodedPng\\n    baseUrl\\n    id\\n    accessibilityLabel\\n    displayAspectRatio\\n  }\\n  listItems {\\n    __typename\\n    title\\n  }\\n  seeRoomFeaturesButton {\\n    __typename\\n    title\\n    loggingEventData {\\n      __typename\\n      ...MerlinLoggingEventData\\n    }\\n  }\\n  roomArrangements {\\n    __typename\\n    title\\n    subtitle\\n    icons\\n  }\\n  roomFeaturesListItems {\\n    __typename\\n    title\\n  }\\n  roomAmenitiesGroups {\\n    __typename\\n    title\\n    subtitle\\n    amenities {\\n      __typename\\n      id\\n      available\\n      title\\n      subtitle\\n      icon\\n      image {\\n        __typename\\n        ...PdpImageFragment\\n      }\\n    }\\n  }\\n  loggingEventData {\\n    __typename\\n    ...MerlinLoggingEventData\\n  }\\n}\\n\\nfragment HotelRoomsSectionFragment on MerlinHotelRoomsSection {\\n  __typename\\n  bookItButtonByPlacement {\\n    __typename\\n    defaultText\\n    drawerButton {\\n      __typename\\n      ...BookItButtonByPlacement\\n    }\\n    footerButton {\\n      __typename\\n      ...BookItButtonByPlacement\\n    }\\n    sideBarButton {\\n      __typename\\n      ...BookItButtonByPlacement\\n    }\\n    stickyNavButton {\\n      __typename\\n      ...BookItButtonByPlacement\\n    }\\n    calendarFooterButton {\\n      __typename\\n      ...BookItButtonByPlacement\\n    }\\n    roomRateButton {\\n      __typename\\n      ...BookItButtonByPlacement\\n    }\\n  }\\n  available\\n  title\\n  subtitle\\n  rooms {\\n    __typename\\n    ...HotelRoomCardItemFragment\\n  }\\n  seeAllRoomsButton {\\n    __typename\\n    title\\n    loggingEventData {\\n      __typename\\n      ...MerlinLoggingEventData\\n    }\\n  }\\n  emptyStateExploreNearbyPlacesButton {\\n    __typename\\n    title\\n    anchor\\n    loggingEventData {\\n      __typename\\n      ...MerlinLoggingEventData\\n    }\\n  }\\n  localizedSelectedDates\\n  productRateSections {\\n    __typename\\n    title\\n    subtitle\\n    sectionType\\n    productRateGroups {\\n      __typename\\n      groupTitle {\\n        __typename\\n        icon\\n        title\\n      }\\n      title\\n      productId\\n      productRateItems {\\n        __typename\\n        barPrice {\\n          __typename\\n          ...BookItBarPrice\\n        }\\n        rateDetailsHighlights {\\n          __typename\\n          icon\\n          title\\n        }\\n        ratePlanId\\n      }\\n    }\\n  }\\n}\\n\\nfragment HotelSingleRoomSectionFragment on MerlinHotelSingleRoomSection {\\n  __typename\\n  title\\n  subsectionTitle\\n  arrangementDetails {\\n    __typename\\n    ...RoomArrangementItemFragment\\n  }\\n  roomDetail {\\n    __typename\\n    title\\n    icons\\n    images {\\n      __typename\\n      previewEncodedPng\\n      baseUrl\\n      id\\n      accessibilityLabel\\n      displayAspectRatio\\n    }\\n    listItems {\\n      __typename\\n      title\\n    }\\n  }\\n}\\n\\nfragment InsertSectionFragment on MerlinInsertSection {\\n  __typename\\n  learnMoreButton {\\n    __typename\\n    title\\n    anchor\\n    loggingEventData {\\n      __typename\\n      ...MerlinLoggingEventData\\n    }\\n  }\\n  logo\\n  subtitle\\n  title\\n}\\n\\nfragment InterceptSurveySectionFragment on MerlinInterceptSurveySection {\\n  __typename\\n  interceptId\\n  interceptSurveyVendor\\n}\\n\\nfragment LocationPdpSectionFragment on MerlinLocationSection {\\n  __typename\\n  title\\n  subtitle\\n  lat\\n  lng\\n  homeIcon\\n  mapMarkerType\\n  address\\n  addressTitle\\n  locationDisclaimer\\n  previewLocationDetails {\\n    __typename\\n    id\\n    displayType\\n    title\\n    content {\\n      __typename\\n      ...ReadMoreHtml\\n    }\\n    items {\\n      __typename\\n      title\\n      subtitle\\n      kicker\\n    }\\n    walkScoresContent {\\n      __typename\\n      items {\\n        __typename\\n        description\\n        label\\n        score\\n      }\\n    }\\n  }\\n  summaryLocationDetails {\\n    __typename\\n    id\\n    displayType\\n    title\\n    content {\\n      __typename\\n      ...ReadMoreHtml\\n    }\\n    items {\\n      __typename\\n      title\\n      subtitle\\n      kicker\\n    }\\n    walkScoresContent {\\n      __typename\\n      items {\\n        __typename\\n        description\\n        label\\n        score\\n      }\\n    }\\n  }\\n  seeAllLocationDetails {\\n    __typename\\n    id\\n    displayType\\n    title\\n    content {\\n      __typename\\n      ...ReadMoreHtml\\n    }\\n    items {\\n      __typename\\n      title\\n      subtitle\\n      kicker\\n    }\\n    walkScoresContent {\\n      __typename\\n      items {\\n        __typename\\n        description\\n        label\\n        score\\n      }\\n    }\\n  }\\n  seeAllDetailsButton {\\n    __typename\\n    title\\n    loggingEventData {\\n      __typename\\n      ...MerlinLoggingEventData\\n    }\\n  }\\n  hostGuidebookButton {\\n    __typename\\n    anchor\\n    title\\n    loggingEventData {\\n      __typename\\n      ...MerlinLoggingEventData\\n    }\\n  }\\n  mapMarkerRadiusInMeters\\n}\\n\\nfragment LrEducationalModalFragment on MerlinGeneralListContentSection {\\n  __typename\\n  title\\n  subtitle\\n  items {\\n    __typename\\n    title\\n    subtitle\\n    icon\\n    anchor\\n    image {\\n      __typename\\n      baseUrl\\n      accessibilityLabel\\n    }\\n    loggingEventData {\\n      __typename\\n      ...MerlinLoggingEventData\\n    }\\n  }\\n}\\n\\nfragment LuxeChatBubbleSectionFragment on MerlinLuxeChatBubbleSection {\\n  __typename\\n  icon\\n  title\\n  heroMedia {\\n    __typename\\n    landscapePicture {\\n      __typename\\n      baseUrl\\n      orientation\\n      previewEncodedPng\\n      id\\n    }\\n    portraitPicture {\\n      __typename\\n      baseUrl\\n      orientation\\n      previewEncodedPng\\n      id\\n    }\\n  }\\n  overviewItems {\\n    __typename\\n    title\\n    anchor\\n    loggingEventData {\\n      __typename\\n      ...MerlinLoggingEventData\\n    }\\n  }\\n}\\n\\nfragment LuxeDescriptionSectionFragment on MerlinLuxeDescriptionSection {\\n  __typename\\n  htmlDescription {\\n    __typename\\n    ...ReadMoreHtml\\n  }\\n  ugcTranslationButton {\\n    __typename\\n    ...UgcTranslationButton\\n  }\\n  showMoreDescriptionButton {\\n    __typename\\n    title\\n    loggingEventData {\\n      __typename\\n      ...MerlinLoggingEventData\\n    }\\n  }\\n  expandedDescriptionTitle\\n  logoAccessibilityLabel\\n}\\n\\nfragment LuxeHeroSectionFragment on MerlinLuxeHeroSection {\\n  __typename\\n  title\\n  logo\\n  overviewItems {\\n    __typename\\n    title\\n    subtitle\\n    icon\\n    anchor\\n    loggingEventData {\\n      __typename\\n      ...MerlinLoggingEventData\\n    }\\n  }\\n  saveButton {\\n    __typename\\n    ...ShareSaveButton\\n  }\\n  unsaveButton {\\n    __typename\\n    ...ShareSaveButton\\n  }\\n  shareButton {\\n    __typename\\n    ...ShareSaveButton\\n  }\\n  seePhotosButton {\\n    __typename\\n    ...SeePhotosButton\\n  }\\n  previewImageLoggingEventData {\\n    __typename\\n    ...MerlinLoggingEventData\\n  }\\n  heroMedia {\\n    __typename\\n    landscapePicture {\\n      __typename\\n      baseUrl\\n      orientation\\n      previewEncodedPng\\n      id\\n    }\\n    portraitPicture {\\n      __typename\\n      baseUrl\\n      orientation\\n      previewEncodedPng\\n      id\\n    }\\n  }\\n}\\n\\nfragment LuxeUnstructuredDescriptionSectionFragment on MerlinLuxeUnstructuredDescriptionSection {\\n  __typename\\n  descriptionJsonString\\n  featuresJsonString\\n  readMoreButton {\\n    __typename\\n    title\\n    loggingEventData {\\n      __typename\\n      ...MerlinLoggingEventData\\n    }\\n  }\\n  showMoreDescriptionButton {\\n    __typename\\n    title\\n    loggingEventData {\\n      __typename\\n      ...MerlinLoggingEventData\\n    }\\n  }\\n  expandedDescriptionTitle\\n  logoAccessibilityLabel\\n}\\n\\nfragment MarqueeBookItButtonByPlacement on MerlinBookItButtonByPlacement {\\n  __typename\\n  footerButton {\\n    __typename\\n    title\\n    loggingEventData {\\n      __typename\\n      ...MerlinLoggingEventData\\n    }\\n    action {\\n      __typename\\n      ... on MerlinNavigateToUrl {\\n        url\\n      }\\n    }\\n  }\\n  sideBarButton {\\n    __typename\\n    title\\n    loggingEventData {\\n      __typename\\n      ...MerlinLoggingEventData\\n    }\\n    action {\\n      __typename\\n      ... on MerlinNavigateToUrl {\\n        url\\n      }\\n    }\\n  }\\n  stickyNavButton {\\n    __typename\\n    title\\n    loggingEventData {\\n      __typename\\n      ...MerlinLoggingEventData\\n    }\\n    action {\\n      __typename\\n      ... on MerlinNavigateToUrl {\\n        url\\n      }\\n    }\\n  }\\n}\\n\\nfragment MarqueeBookItFloatingFooterSectionFragment on MerlinMarqueeBookItSection {\\n  __typename\\n  actionType\\n  barPrice {\\n    __typename\\n    ...BookItBarPrice\\n  }\\n  bookItButtonByPlacement {\\n    __typename\\n    ...MarqueeBookItButtonByPlacement\\n  }\\n  subtitle\\n}\\n\\nfragment MarqueeBookItNavSectionFragment on MerlinMarqueeBookItSection {\\n  __typename\\n  actionType\\n  barPrice {\\n    __typename\\n    ...BookItBarPrice\\n  }\\n  bookItButtonByPlacement {\\n    __typename\\n    ...MarqueeBookItButtonByPlacement\\n  }\\n  subtitle\\n  title\\n}\\n\\nfragment MarqueeBookItSidebarSectionFragment on MerlinMarqueeBookItSection {\\n  __typename\\n  actionType\\n  barPrice {\\n    __typename\\n    ...BookItBarPrice\\n  }\\n  bookItButtonByPlacement {\\n    __typename\\n    ...MarqueeBookItButtonByPlacement\\n  }\\n  subtitle\\n  title\\n}\\n\\nfragment MerlinBookItSectionFragment on MerlinBookItSection {\\n  __typename\\n  title\\n  reviewCount\\n  reviewRating\\n  maxGuestCapacity\\n  available\\n  can_instant_book: canInstantBook\\n  price_disclaimer: priceDisclaimer\\n  localized_unavailability_message: localizedUnavailabilityMessage\\n  localized_unavailability_message_position_string: localizedUnavailabilityMessagePositionString\\n  tpoint_content: tpointContent {\\n    __typename\\n    title\\n    subtitle\\n  }\\n  cancellation_policies: cancellationPolicies {\\n    __typename\\n    cancellation_policy_id: id\\n    title\\n    subtitle\\n    milestones {\\n      __typename\\n      titles\\n      subtitles\\n      type\\n      color\\n      timeline_length_percentage: timelineLengthPercentage\\n      milestoneDateTime\\n    }\\n    seeDetailsLink {\\n      __typename\\n      title\\n      anchor\\n    }\\n    cancellation_policy_price_type: cancellationPolicyPriceType\\n    localized_cancellation_policy_name: localizedCancellationPolicyName\\n    book_it_module_tooltip: bookItModuleTooltip\\n  }\\n  barPrice {\\n    __typename\\n    displayPrices {\\n      __typename\\n      type\\n      priceString\\n      displayRateType\\n    }\\n  }\\n  price: legacyPrice {\\n    __typename\\n    price_items: priceItems {\\n      __typename\\n      ...ChinaBookItSectionDisplayPriceLineItem\\n    }\\n    total {\\n      __typename\\n      amount\\n      amount_micros: amountMicros\\n      amount_formatted: amountFormatted\\n      is_micros_accuracy: isMicrosAccuracy\\n      currency\\n    }\\n    type\\n    localized_title: localizedTitle\\n    original_total_item: originalTotalItem {\\n      __typename\\n      ...ChinaBookItSectionDisplayPriceLineItem\\n    }\\n    localized_explanation: localizedExplanation\\n    extra_data: extraData\\n    discount_data: discountData {\\n      __typename\\n      tiered_pricing_discount_data: tieredPricingDiscountData {\\n        __typename\\n        total_with_discount: totalWithDiscount {\\n          __typename\\n          ...ChinaBookItSectionFormattedPriceAmount\\n        }\\n        total_without_discount: totalWithoutDiscount {\\n          __typename\\n          ...ChinaBookItSectionFormattedPriceAmount\\n        }\\n      }\\n      china_discount_promotion_data: chinaDiscountPromotionData {\\n        __typename\\n        applicable_discounts: applicableDiscounts {\\n          __typename\\n          discount_type: discountType\\n          localized_title: localizedTitle\\n          is_applied: isApplied\\n          should_shown_on_bar: shouldShowOnBar\\n          min_nights: minNights\\n          localized_explanation: localizedExplanation\\n          discount_rate: discountRate\\n        }\\n        total_saved_amount: totalSavedAmount {\\n          __typename\\n          ...ChinaBookItSectionFormattedPriceAmount\\n        }\\n        bar_display_price_amount_without_discount: barDisplayPriceAmountWithoutDiscount {\\n          __typename\\n          ...ChinaBookItSectionFormattedPriceAmount\\n        }\\n      }\\n      pricing_discount_data: pricingDiscountData {\\n        __typename\\n        total_amount_without_discount: totalAmountWithoutDiscount {\\n          __typename\\n          ...ChinaBookItSectionFormattedPriceAmount\\n        }\\n        total_amount_with_discount: totalAmountWithDiscount {\\n          __typename\\n          ...ChinaBookItSectionFormattedPriceAmount\\n        }\\n        bar_display_price_amount_without_discount: barDisplayPriceAmountWithoutDiscount {\\n          __typename\\n          ...ChinaBookItSectionFormattedPriceAmount\\n        }\\n        bar_display_price_without_discount_disclaimer: barDisplayPriceWithoutDiscountDisclaimer {\\n          __typename\\n          disclaimer\\n          user_country_signature_for_legal_checking: userCountrySignatureForLegalChecking\\n        }\\n        listing_card_message_saved_amount: listingCardMessageSavedAmount {\\n          __typename\\n          ...ChinaBookItSectionFormattedPriceAmount\\n        }\\n      }\\n    }\\n  }\\n  bookItButtonByPlacement {\\n    __typename\\n    defaultText\\n    sideBarButton {\\n      __typename\\n      title\\n    }\\n  }\\n  chinaLegacyBookingFieldsForMigration {\\n    __typename\\n    p3_message_data: p3MessageData {\\n      __typename\\n      message_type: messageType\\n      message {\\n        __typename\\n        icon\\n        headline\\n        body\\n        contextual_message: contextualMessage\\n        icon_url: iconUrl\\n        cta_url: ctaUrl\\n        cta_text: ctaText\\n      }\\n      action {\\n        __typename\\n        type\\n        payload {\\n          __typename\\n          check_in: checkIn\\n          check_out: checkOut\\n        }\\n        confirmation_message_type: confirmationMessageType\\n        label\\n      }\\n    }\\n    p3_display_rate: p3DisplayRate {\\n      __typename\\n      amount\\n      amount_micros: amountMicros\\n      amount_formatted: amountFormatted\\n      is_micros_accuracy: isMicrosAccuracy\\n      currency\\n    }\\n  }\\n}\\n\\nfragment MerlinChinaAvailabilityCalendarSectionFragment on MerlinChinaAvailabilityCalendarSection {\\n  __typename\\n  title\\n  minNights\\n  hasExtraGuestFee\\n}\\n\\nfragment MerlinChinaBookItSectionFragment on MerlinChinaBookItSection {\\n  __typename\\n  title\\n  reviewCount\\n  reviewRating\\n  maxGuestCapacity\\n  available\\n  can_instant_book: canInstantBook\\n  price_disclaimer: priceDisclaimer\\n  localized_unavailability_message: localizedUnavailabilityMessage\\n  localized_unavailability_message_position_string: localizedUnavailabilityMessagePositionString\\n  tpoint_content: tpointContent {\\n    __typename\\n    title\\n    subtitle\\n  }\\n  cancellation_policies: cancellationPolicies {\\n    __typename\\n    cancellation_policy_id: id\\n    title\\n    subtitle\\n    milestones {\\n      __typename\\n      titles\\n      subtitles\\n      type\\n      color\\n      timeline_length_percentage: timelineLengthPercentage\\n      milestoneDateTime\\n    }\\n    seeDetailsLink {\\n      __typename\\n      title\\n      anchor\\n    }\\n    cancellation_policy_price_type: cancellationPolicyPriceType\\n    localized_cancellation_policy_name: localizedCancellationPolicyName\\n    book_it_module_tooltip: bookItModuleTooltip\\n  }\\n  price: legacyPrice {\\n    __typename\\n    price_items: priceItems {\\n      __typename\\n      ...ChinaBookItSectionDisplayPriceLineItem\\n    }\\n    total {\\n      __typename\\n      amount\\n      amount_micros: amountMicros\\n      amount_formatted: amountFormatted\\n      is_micros_accuracy: isMicrosAccuracy\\n      currency\\n    }\\n    type\\n    localized_title: localizedTitle\\n    localized_explanation: localizedExplanation\\n    extra_data: extraData\\n    discount_data: discountData {\\n      __typename\\n      tiered_pricing_discount_data: tieredPricingDiscountData {\\n        __typename\\n        total_with_discount: totalWithDiscount {\\n          __typename\\n          ...ChinaBookItSectionFormattedPriceAmount\\n        }\\n        total_without_discount: totalWithoutDiscount {\\n          __typename\\n          ...ChinaBookItSectionFormattedPriceAmount\\n        }\\n      }\\n      china_discount_promotion_data: chinaDiscountPromotionData {\\n        __typename\\n        applicable_discounts: applicableDiscounts {\\n          __typename\\n          discount_type: discountType\\n          localized_title: localizedTitle\\n          is_applied: isApplied\\n          should_shown_on_bar: shouldShowOnBar\\n          min_nights: minNights\\n          localized_explanation: localizedExplanation\\n          discount_rate: discountRate\\n        }\\n        total_saved_amount: totalSavedAmount {\\n          __typename\\n          ...ChinaBookItSectionFormattedPriceAmount\\n        }\\n        bar_display_price_amount_without_discount: barDisplayPriceAmountWithoutDiscount {\\n          __typename\\n          ...ChinaBookItSectionFormattedPriceAmount\\n        }\\n      }\\n      pricing_discount_data: pricingDiscountData {\\n        __typename\\n        total_amount_without_discount: totalAmountWithoutDiscount {\\n          __typename\\n          ...ChinaBookItSectionFormattedPriceAmount\\n        }\\n        total_amount_with_discount: totalAmountWithDiscount {\\n          __typename\\n          ...ChinaBookItSectionFormattedPriceAmount\\n        }\\n        bar_display_price_amount_without_discount: barDisplayPriceAmountWithoutDiscount {\\n          __typename\\n          ...ChinaBookItSectionFormattedPriceAmount\\n        }\\n        bar_display_price_without_discount_disclaimer: barDisplayPriceWithoutDiscountDisclaimer {\\n          __typename\\n          disclaimer\\n          user_country_signature_for_legal_checking: userCountrySignatureForLegalChecking\\n        }\\n        listing_card_message_saved_amount: listingCardMessageSavedAmount {\\n          __typename\\n          ...ChinaBookItSectionFormattedPriceAmount\\n        }\\n      }\\n    }\\n  }\\n  bookItButtonByPlacement {\\n    __typename\\n    defaultText\\n    sideBarButton {\\n      __typename\\n      title\\n    }\\n  }\\n  rateType\\n  displayRate {\\n    __typename\\n    amount\\n    amount_micros: amountMicros\\n    amount_formatted: amountFormatted\\n    is_micros_accuracy: isMicrosAccuracy\\n    currency\\n  }\\n  uncMessageData {\\n    __typename\\n    message_type: messageType\\n    message {\\n      __typename\\n      body\\n      contextual_message: contextualMessage\\n      cta_text: ctaText\\n      cta_url: ctaUrl\\n      headline\\n      icon\\n      icon_url: iconUrl\\n    }\\n    action {\\n      __typename\\n      confirmation_message_type: confirmationMessageType\\n      label\\n      payload {\\n        __typename\\n        check_in: checkIn\\n        check_out: checkOut\\n      }\\n      type\\n    }\\n  }\\n}\\n\\nfragment MerlinChinaHeroSectionFragment on MerlinChinaHeroSection {\\n  __typename\\n  title\\n  defaultWishlistName\\n  photos {\\n    __typename\\n    accessibilityLabel\\n    aspectRatio\\n    baseUrl\\n    id\\n    previewEncodedPng\\n  }\\n  seePhotosButton {\\n    __typename\\n    title\\n    subtitle\\n    accessibilityLabel\\n    anchor\\n  }\\n  saveButton {\\n    __typename\\n    title\\n    loggingEventData {\\n      __typename\\n      ...MerlinLoggingEventData\\n    }\\n  }\\n  shareButton {\\n    __typename\\n    title\\n    loggingEventData {\\n      __typename\\n      ...MerlinLoggingEventData\\n    }\\n  }\\n  unsaveButton {\\n    __typename\\n    title\\n    loggingEventData {\\n      __typename\\n      ...MerlinLoggingEventData\\n    }\\n  }\\n}\\n\\nfragment MerlinChinaHostIntroSectionFragment on MerlinChinaHostProfileSection {\\n  __typename\\n  title\\n  primaryHost {\\n    __typename\\n    about\\n    additionalHosts {\\n      __typename\\n      details {\\n        __typename\\n        baseUrl\\n        profilePath\\n      }\\n      subtitle\\n      title\\n    }\\n    badges {\\n      __typename\\n      count\\n      id\\n      imagePath\\n      imageSize\\n      label\\n      link\\n    }\\n    baseUrl\\n    hostIntroTags\\n    hostName\\n    id\\n    languages\\n    memberSinceFullStr\\n    profilePath\\n    readMoreButton {\\n      __typename\\n      ...PdpChinaBasicListItem\\n    }\\n    responseRateWithoutNa\\n    responseTimeWithoutNa\\n    isSuperhost\\n    license\\n  }\\n  translationButton {\\n    __typename\\n    ...ChinaTranslationButton\\n  }\\n  descriptions {\\n    __typename\\n    title\\n    modalTitle\\n    items {\\n      __typename\\n      type\\n      title\\n      content {\\n        __typename\\n        original\\n        translated\\n      }\\n    }\\n    readMoreButton {\\n      __typename\\n      ...PdpChinaBasicListItem\\n    }\\n  }\\n  contactHostButton {\\n    __typename\\n    title\\n    subtitle\\n  }\\n}\\n\\nfragment MerlinChinaHostProfileSectionFragment on MerlinChinaHostProfileSection {\\n  __typename\\n  title\\n  primaryHost {\\n    __typename\\n    about\\n    additionalHosts {\\n      __typename\\n      details {\\n        __typename\\n        hostName\\n        baseUrl\\n        profilePath\\n      }\\n      subtitle\\n      title\\n    }\\n    badges {\\n      __typename\\n      count\\n      id\\n      imagePath\\n      imageSize\\n      label\\n      link\\n    }\\n    baseUrl\\n    hostIntroTags\\n    hostName\\n    id\\n    languages\\n    memberSinceFullStr\\n    profilePath\\n    readMoreButton {\\n      __typename\\n      accessibilityLabel\\n      anchor\\n      icon\\n      image {\\n        __typename\\n        baseUrl\\n      }\\n      subtitle\\n      title\\n    }\\n    responseRateWithoutNa\\n    responseTimeWithoutNa\\n    isSuperhost\\n  }\\n  translationButton {\\n    __typename\\n    ...ChinaTranslationButton\\n  }\\n  descriptions {\\n    __typename\\n    title\\n    modalTitle\\n    items {\\n      __typename\\n      type\\n      title\\n      content {\\n        __typename\\n        original\\n        translated\\n      }\\n    }\\n    readMoreButton {\\n      __typename\\n      title\\n      loggingEventData {\\n        __typename\\n        section\\n        component\\n        loggingId\\n      }\\n    }\\n  }\\n}\\n\\nfragment MerlinChinaListingDetailSectionFragment on MerlinChinaListingDetailSection {\\n  __typename\\n  title\\n  hometourRooms {\\n    __typename\\n    highlightsHometour\\n    icons\\n    id\\n    nameWithType\\n  }\\n  listingDetails: details {\\n    __typename\\n    title\\n    subtitle\\n    icon\\n    accessibilityLabel\\n  }\\n  listingAmenities {\\n    __typename\\n    icon\\n    title\\n    subtitle\\n    id\\n    available\\n  }\\n}\\n\\nfragment MerlinChinaLocationInfoSectionFragment on MerlinChinaLocationInfoSection {\\n  __typename\\n  lat\\n  lng\\n  countryCode\\n  translationButton {\\n    __typename\\n    ...ChinaTranslationButton\\n  }\\n  descriptions {\\n    __typename\\n    title\\n    modalTitle\\n    items {\\n      __typename\\n      content {\\n        __typename\\n        original\\n        translated\\n      }\\n      type\\n      title\\n    }\\n    readMoreButton {\\n      __typename\\n      ...PdpChinaBasicListItem\\n    }\\n  }\\n  locationDisclaimer\\n  pointsOfInterest {\\n    __typename\\n    type\\n    items {\\n      __typename\\n      name\\n      tag\\n      distance\\n      type\\n      lat\\n      lng\\n    }\\n  }\\n  summaryAddress\\n  title\\n  formatAddress {\\n    __typename\\n    ...PdpChinaBasicListItem\\n  }\\n  displayExactLocation\\n}\\n\\nfragment MerlinChinaPoliciesSectionFragment on MerlinChinaPoliciesSection {\\n  __typename\\n  title\\n  cancellationPolicy {\\n    __typename\\n    subtitle\\n    title\\n  }\\n  chinaCancellationPolicies: cancellationPolicies {\\n    __typename\\n    cancellation_policy_id: id\\n    title\\n    subtitle\\n    subtitles\\n    milestones {\\n      __typename\\n      color\\n      subtitles\\n      timeline_length_percentage: timelineLengthPercentage\\n      timeline_width_percentage: timelineWidthPercentage\\n      titles\\n      type\\n      is_dated: isDated\\n      show_today: showToday\\n      milestone_date_time: milestoneDateTime\\n    }\\n    seeDetailsLink {\\n      __typename\\n      title\\n      anchor\\n    }\\n    cancellation_policy_price_type: cancellationPolicyPriceType\\n    localized_cancellation_policy_name: localizedCancellationPolicyName\\n    book_it_module_tooltip: bookItModuleTooltip\\n    cancellation_policy_price_factor: cancellationPolicyPriceFactor\\n  }\\n  checkInOut {\\n    __typename\\n    subtitle\\n    title\\n    details {\\n      __typename\\n      title\\n    }\\n  }\\n  servicesTime {\\n    __typename\\n    subtitle\\n    title\\n    details {\\n      __typename\\n      title\\n    }\\n  }\\n  chinaHouseRules: houseRules {\\n    __typename\\n    subtitle\\n    title\\n    details {\\n      __typename\\n      title\\n    }\\n  }\\n  translationButton {\\n    __typename\\n    ...ChinaTranslationButton\\n  }\\n  descriptions {\\n    __typename\\n    items {\\n      __typename\\n      content {\\n        __typename\\n        original\\n        translated\\n      }\\n      title\\n      type\\n    }\\n    modalTitle\\n    title\\n  }\\n  safetyNotes {\\n    __typename\\n    subtitle\\n    title\\n    readMoreButton {\\n      __typename\\n      subtitle\\n      title\\n    }\\n    details {\\n      __typename\\n      title\\n    }\\n  }\\n  riskEducation {\\n    __typename\\n    subtitle\\n    title\\n    readMoreButton {\\n      __typename\\n      ...PdpChinaBasicListItem\\n    }\\n    details {\\n      __typename\\n      title\\n    }\\n  }\\n  businessTravel {\\n    __typename\\n    subtitle\\n    title\\n    readMoreButton {\\n      __typename\\n      ...PdpChinaBasicListItem\\n    }\\n    details {\\n      __typename\\n      title\\n    }\\n  }\\n  chinaListingExpectations: listingExpectations {\\n    __typename\\n    title\\n    items {\\n      __typename\\n      title\\n      content {\\n        __typename\\n        original\\n        translated\\n      }\\n    }\\n  }\\n  safetyListingExpectations {\\n    __typename\\n    title\\n    items {\\n      __typename\\n      title\\n      icon\\n      content {\\n        __typename\\n        original\\n        translated\\n      }\\n    }\\n  }\\n  safetyExpectationsAndAmenities {\\n    __typename\\n    title\\n    icon\\n  }\\n  documentDisplay {\\n    __typename\\n    subtitle\\n    title\\n    readMoreButton {\\n      __typename\\n      ...PdpChinaBasicListItem\\n    }\\n    details {\\n      __typename\\n      title\\n    }\\n  }\\n  documentDisplayModalTitle\\n  documentDisplayPictures {\\n    __typename\\n    title\\n    images {\\n      __typename\\n      accessibilityLabel\\n      aspectRatio\\n      baseUrl\\n      id\\n      previewEncodedPng\\n    }\\n  }\\n}\\n\\nfragment MerlinChinaReviewsSectionFragment on MerlinChinaReviewsSection {\\n  __typename\\n  title\\n  translationButton {\\n    __typename\\n    ...ChinaTranslationButton\\n  }\\n  reviewDetails {\\n    __typename\\n    hostOtherPropertyReviewButton {\\n      __typename\\n      accessibilityLabel\\n      anchor\\n      icon\\n      image {\\n        __typename\\n        baseUrl\\n      }\\n      subtitle\\n      title\\n    }\\n    hostOtherPropertyReviewCount\\n    nReviewsPerPage\\n    reviewCount\\n    reviewCountCopy\\n    reviewScore\\n    reviewStarColor\\n    reviewScoreDescription\\n    reviewSummary {\\n      __typename\\n      category\\n      label\\n      localizedRating\\n      percentage\\n      value\\n    }\\n    starRating\\n    displayReviewSummary\\n    showReviewTag\\n    reviewTagSummary {\\n      __typename\\n      count\\n      localized_tag_name: localizedName\\n      tag\\n      fill_color: fillColor\\n      content_color: contentColor\\n      fill_color_selected: fillColorSelected\\n      content_color_selected: contentColorSelected\\n    }\\n  }\\n  emptyReviewContent {\\n    __typename\\n    title\\n    subtitle\\n  }\\n}\\n\\nfragment MerlinChinaStpExplanationInfoSectionFragment on MerlinChinaStpExplanationInfoSection {\\n  __typename\\n  title\\n  noStrikeThroughText\\n  strikeThroughText\\n  isAnxinListing\\n  anxinListingText\\n}\\n\\nfragment MerlinChinaTieredPricingSectionFragment on MerlinChinaTieredPricingSection {\\n  __typename\\n  title\\n  discountData {\\n    __typename\\n    tieredPricingDiscountData {\\n      __typename\\n      savedAmount {\\n        __typename\\n        amountFormatted\\n      }\\n    }\\n  }\\n  cancellationPolicies {\\n    __typename\\n    cancellation_policy_id: id\\n    title\\n    subtitle\\n    subtitles\\n    milestones {\\n      __typename\\n      color\\n      subtitles\\n      timeline_length_percentage: timelineLengthPercentage\\n      timeline_width_percentage: timelineWidthPercentage\\n      titles\\n      type\\n      is_dated: isDated\\n      show_today: showToday\\n      milestone_date_time: milestoneDateTime\\n    }\\n    seeDetailsLink {\\n      __typename\\n      title\\n      anchor\\n    }\\n    cancellation_policy_price_type: cancellationPolicyPriceType\\n    localized_cancellation_policy_name: localizedCancellationPolicyName\\n    book_it_module_tooltip: bookItModuleTooltip\\n    cancellation_policy_price_factor: cancellationPolicyPriceFactor\\n  }\\n}\\n\\nfragment MerlinChinaTitleSectionFragment on MerlinChinaTitleSection {\\n  __typename\\n  title\\n  highlightMessageDatas {\\n    __typename\\n    ctaContent\\n    description\\n    icon\\n    iconColor\\n    link\\n    style\\n    tag\\n    tagBackgroundColor\\n  }\\n  chinaTitleDetails: details {\\n    __typename\\n    accessibilityLabel\\n    anchor\\n    icon\\n    subtitle\\n    title\\n  }\\n  kickers {\\n    __typename\\n    content\\n    contentColor\\n  }\\n  previewTags {\\n    __typename\\n    color\\n    fillColor\\n    name\\n    relatedSectionType\\n    type\\n  }\\n  chinaListingTitle: listingTitle {\\n    __typename\\n    original\\n    translated\\n  }\\n}\\n\\nfragment MerlinCrossSellSectionFragment on MerlinCrossSellSection {\\n  __typename\\n  title\\n}\\n\\nfragment MerlinEducationFooterBannerSectionFragment on MerlinEducationFooterBannerSection {\\n  __typename\\n  pdpEducationContentData {\\n    __typename\\n    pdpFooterBanner {\\n      __typename\\n      displayBehaviorType\\n      accessibilityHeadline\\n      htmlHeadline\\n      expandedState {\\n        __typename\\n        icon\\n        headline\\n        body\\n      }\\n    }\\n  }\\n}\\n\\nfragment MerlinLoggingEventData on MerlinLoggingEventData {\\n  __typename\\n  loggingId\\n  section\\n  component\\n  experiments {\\n    __typename\\n    experiment\\n    treatment\\n    dontLogOnFormFactor\\n  }\\n}\\n\\nfragment MerlinNavSectionFragment on MerlinChinaNavSection {\\n  __typename\\n  logo\\n  saveButton {\\n    __typename\\n    title\\n    loggingEventData {\\n      __typename\\n      ...MerlinLoggingEventData\\n    }\\n  }\\n  shareButton {\\n    __typename\\n    title\\n    loggingEventData {\\n      __typename\\n      ...MerlinLoggingEventData\\n    }\\n  }\\n  unsaveButton {\\n    __typename\\n    title\\n    loggingEventData {\\n      __typename\\n      ...MerlinLoggingEventData\\n    }\\n  }\\n  chinaNavItems: navItems {\\n    __typename\\n    title\\n    loggingEventData {\\n      __typename\\n      ...MerlinLoggingEventData\\n    }\\n    scrollId\\n    id\\n    color\\n  }\\n}\\n\\nfragment MerlinReportToAirbnbSectionFragment on MerlinReportToAirbnbSection {\\n  __typename\\n  reportButton {\\n    __typename\\n    title\\n    loggingEventData {\\n      __typename\\n      ...MerlinLoggingEventData\\n    }\\n  }\\n  entityType\\n}\\n\\nfragment MerlinShareSaveFragment on MerlinShareSave {\\n  __typename\\n  entityId\\n  entityType\\n  shareButton {\\n    __typename\\n    ...ShareSaveButton\\n  }\\n  saveButton {\\n    __typename\\n    ...ShareSaveButton\\n  }\\n  unsaveButton {\\n    __typename\\n    ...ShareSaveButton\\n  }\\n  sharingConfig {\\n    __typename\\n    title\\n    propertyType\\n    location\\n    personCapacity\\n    imageUrl\\n    pdpLink\\n    reviewCount\\n    starRating\\n  }\\n  embedData {\\n    __typename\\n    ... on MerlinStayEmbedData {\\n      id\\n      name\\n      personCapacity\\n      pictureUrl\\n      propertyType\\n      url\\n      reviewCount\\n      starRating\\n    }\\n  }\\n}\\n\\nfragment MessageBannerSectionFragment on MerlinMessageBannerSection {\\n  __typename\\n  title\\n  subtitle\\n  ctaButton {\\n    __typename\\n    title\\n    anchor\\n    loggingEventData {\\n      __typename\\n      ...MerlinLoggingEventData\\n    }\\n  }\\n  accentColor {\\n    __typename\\n    hex\\n  }\\n}\\n\\nfragment MosaicSystemMediaBlockContainerFragment on MerlinMediaBlockContainer {\\n  __typename\\n  flip\\n  format\\n  mediaBlock {\\n    __typename\\n    ...MosaicSystemMediaBlockFragment\\n  }\\n}\\n\\nfragment MosaicSystemMediaBlockFragment on MerlinMediaBlock {\\n  __typename\\n  ... on MerlinOneLandscapeMediaBlock {\\n    landscapeId\\n  }\\n  ... on MerlinTwoLandscapesMediaBlock {\\n    leftLandscapeId\\n    rightLandscapeId\\n  }\\n  ... on MerlinThreePortraitsMediaBlock {\\n    leftPortraitId\\n    midPortraitId\\n    rightPortraitId\\n  }\\n  ... on MerlinThreePortraitsTallMediaBlock {\\n    leftPortraitId\\n    lowerRightPortraitId\\n    upperRightPortraitId\\n  }\\n  ... on MerlinThreeLandscapesTallMediaBlock {\\n    topLandscapeId\\n    lowerLeftLandscapeId\\n    lowerRightLandscapeId\\n  }\\n  ... on MerlinOneImageMediaBlock {\\n    imageId\\n  }\\n  ... on MerlinTwoPortraitsMediaBlock {\\n    leftPortraitId\\n    rightPortraitId\\n  }\\n  ... on MerlinOnePortraitTwoLandscapesMediaBlock {\\n    lowerLandscapeId\\n    portraitId\\n    upperLandscapeId\\n  }\\n  ... on MerlinTwoPortraitsTwoLandscapesMediaBlock {\\n    lowerLeftLandscapeId\\n    lowerRightPortraitId\\n    upperLeftPortraitId\\n    upperRightLandscapeId\\n  }\\n  ... on MerlinOnePortraitOneLandscapeMediaBlock {\\n    landscapeId\\n    portraitId\\n  }\\n  ... on MerlinOnePortraitMediaBlock {\\n    portraitId\\n  }\\n  ... on MerlinOneLandscapeTwoLandscapesMediaBlock {\\n    leftLandscapeId\\n    upperRightLandscapeId\\n    lowerRightLandscapeId\\n  }\\n  ... on MerlinThreeLandscapesMediaBlock {\\n    leftLandscapeId\\n    midLandscapeId\\n    rightLandscapeId\\n  }\\n  ... on MerlinPortraitWithCaptionMediaBlock {\\n    hostQuote\\n    hostSignature\\n    portraitId\\n  }\\n}\\n\\nfragment MosaicTourPreviewSectionFragment on MerlinMosaicTourPreviewSection {\\n  __typename\\n  images {\\n    __typename\\n    previewEncodedPng\\n    baseUrl\\n    id\\n    accessibilityLabel\\n    displayAspectRatio\\n  }\\n  mediaBlocks {\\n    __typename\\n    ...MosaicSystemMediaBlockContainerFragment\\n  }\\n  numBlocksPerRow\\n  seeAllImagesButton {\\n    __typename\\n    title\\n    loggingEventData {\\n      __typename\\n      ...MerlinLoggingEventData\\n    }\\n  }\\n  previewImageLoggingEventData {\\n    __typename\\n    ...MerlinLoggingEventData\\n  }\\n}\\n\\nfragment NavMobileSectionFragment on MerlinNavMobileSection {\\n  __typename\\n  saveButton {\\n    __typename\\n    ...ShareSaveButton\\n  }\\n  unsaveButton {\\n    __typename\\n    ...ShareSaveButton\\n  }\\n  shareButton {\\n    __typename\\n    ...ShareSaveButton\\n  }\\n  backLink {\\n    __typename\\n    linkRoute\\n    linkText\\n  }\\n  shareSave {\\n    __typename\\n    ...MerlinShareSaveFragment\\n  }\\n}\\n\\nfragment NavSectionFragment on MerlinNavSection {\\n  __typename\\n  logo\\n  navItems {\\n    __typename\\n    id\\n    scrollId\\n    title\\n    count\\n    loggingEventData {\\n      __typename\\n      ...MerlinLoggingEventData\\n    }\\n  }\\n}\\n\\nfragment OverviewSectionFragment on MerlinOverviewSection {\\n  __typename\\n  title\\n  subtitle\\n  shortTitle\\n  hostAvatar {\\n    __typename\\n    avatarImage {\\n      __typename\\n      baseUrl\\n      accessibilityLabel\\n    }\\n    badge\\n    userId\\n    scrollId\\n    loggingEventData {\\n      __typename\\n      ...MerlinLoggingEventData\\n    }\\n  }\\n  detailItems {\\n    __typename\\n    title\\n  }\\n  showBusinessDetailsButton {\\n    __typename\\n    title\\n    loggingEventData {\\n      __typename\\n      ...MerlinLoggingEventData\\n    }\\n  }\\n  businessDetails {\\n    __typename\\n    title\\n    items {\\n      __typename\\n      title\\n      subtitle\\n    }\\n  }\\n  disasterBanner {\\n    __typename\\n    title\\n    subtitle\\n    learnMoreButton {\\n      __typename\\n      title\\n      anchor\\n      loggingEventData {\\n        __typename\\n        ...MerlinLoggingEventData\\n      }\\n    }\\n  }\\n}\\n\\nfragment PdpAmenitiesSectionFragment on MerlinAmenitiesSection {\\n  __typename\\n  title\\n  subtitle\\n  previewAmenitiesGroups {\\n    __typename\\n    title\\n    subtitle\\n    amenities {\\n      __typename\\n      id\\n      available\\n      title\\n      icon\\n      image {\\n        __typename\\n        ...PdpImageFragment\\n      }\\n    }\\n  }\\n  seeAllAmenitiesGroups {\\n    __typename\\n    title\\n    subtitle\\n    amenities {\\n      __typename\\n      id\\n      available\\n      title\\n      subtitle\\n      icon\\n      image {\\n        __typename\\n        ...PdpImageFragment\\n      }\\n    }\\n  }\\n  seeAllAmenitiesButton {\\n    __typename\\n    title\\n    loggingEventData {\\n      __typename\\n      ...MerlinLoggingEventData\\n    }\\n    action {\\n      __typename\\n      loggingData {\\n        __typename\\n        experiments {\\n          __typename\\n          experiment\\n          treatment\\n          dontLogOnFormFactor\\n        }\\n        loggingId\\n      }\\n    }\\n  }\\n}\\n\\nfragment PdpChinaBasicListItem on MerlinChinaBasicListItem {\\n  __typename\\n  accessibilityLabel\\n  anchor\\n  color\\n  icon\\n  image {\\n    __typename\\n    baseUrl\\n  }\\n  loggingEventData {\\n    __typename\\n    ...MerlinLoggingEventData\\n  }\\n  subtitle\\n  title\\n}\\n\\nfragment PdpImageFragment on MerlinImage {\\n  __typename\\n  id\\n  baseUrl\\n  previewEncodedPng\\n  accessibilityLabel\\n  displayAspectRatio\\n}\\n\\nfragment PdpPlatformMetadataFragments on MerlinPdpSectionsMetadata {\\n  __typename\\n  pdpType\\n  pdpUrlType\\n  pageTitle\\n  sharingConfig {\\n    __typename\\n    ...SharingConfigFragment\\n  }\\n  loggingContext {\\n    __typename\\n    paidGrowthRemarketingListingIds\\n    eventDataLogging {\\n      __typename\\n      listingId\\n      page\\n      pdpPageType\\n      listingLat\\n      listingLng\\n      homeTier\\n      bedType\\n      roomType\\n      personCapacity\\n      descriptionLanguage\\n      isSuperhost\\n      pictureCount\\n      utcOffset\\n      amenities\\n      accuracyRating\\n      checkinRating\\n      cleanlinessRating\\n      communicationRating\\n      locationRating\\n      valueRating\\n      guestSatisfactionOverall\\n      visibleReviewCount\\n    }\\n  }\\n  clientLoggingContext {\\n    __typename\\n    productId\\n    pdpType\\n  }\\n  seoFeatures {\\n    __typename\\n    ...ClientSeoTagsFragment\\n  }\\n  initialTranslationState\\n  bookingPrefetchData {\\n    __typename\\n    isHotelRatePlanEnabled\\n    barPrice {\\n      __typename\\n      ...BookItBarPrice\\n    }\\n    canInstantBook\\n    cancellationPolicies {\\n      __typename\\n      cancellation_policy_price_type: cancellationPolicyPriceType\\n      book_it_module_tooltip: bookItModuleTooltip\\n      cancellation_policy_id: cancellationPolicyId\\n      link\\n      link_text: linkText\\n      localized_cancellation_policy_name: localizedCancellationPolicyName\\n      milestones {\\n        __typename\\n        color\\n        subtitles\\n        timeline_length_percentage: timelineLengthPercentage\\n        timeline_width_percentage: timelineWidthPercentage\\n        titles\\n        type\\n      }\\n      subtitles\\n      title\\n    }\\n    p3DepositData {\\n      __typename\\n      p3DepositPriceSchedule {\\n        __typename\\n        priceItems {\\n          __typename\\n          localizedExplanation\\n          localizedTitle\\n          total {\\n            __typename\\n            ...BookItDisplayRate\\n          }\\n          type\\n        }\\n      }\\n    }\\n    p3MessageData {\\n      __typename\\n      messageType\\n      message {\\n        __typename\\n        icon\\n        headline\\n        body\\n        contextualMessage\\n        iconUrl\\n        ctaText\\n        ctaUrl\\n        iconEnum\\n      }\\n      action {\\n        __typename\\n        type\\n        payload {\\n          __typename\\n          checkIn\\n          checkOut\\n        }\\n        confirmationMessageType\\n        label\\n        loggingEventData {\\n          __typename\\n          ...MerlinLoggingEventData\\n        }\\n      }\\n    }\\n    p3CancellationSection {\\n      __typename\\n      cancellationPolicyPriceType\\n    }\\n    price {\\n      __typename\\n      discountData {\\n        __typename\\n        tieredPricingDiscountData {\\n          __typename\\n          totalWithDiscount {\\n            __typename\\n            ...BookItFormattedPriceAmount\\n          }\\n          totalWithoutDiscount {\\n            __typename\\n            ...BookItFormattedPriceAmount\\n          }\\n          savedAmount {\\n            __typename\\n            ...BookItFormattedPriceAmount\\n          }\\n          savedPercentage\\n        }\\n      }\\n      type\\n      localizedTitle\\n      localizedExplanation\\n    }\\n    tpointContent {\\n      __typename\\n      subtitle\\n      title\\n    }\\n    productRateSections {\\n      __typename\\n      title\\n      subtitle\\n      sectionType\\n      productRateGroups {\\n        __typename\\n        groupTitle {\\n          __typename\\n          icon\\n          title\\n        }\\n        title\\n        productId\\n        productRateItems {\\n          __typename\\n          barPrice {\\n            __typename\\n            ...BookItBarPrice\\n          }\\n          rateDetailsHighlights {\\n            __typename\\n            icon\\n            title\\n          }\\n          ratePlanId\\n        }\\n      }\\n    }\\n    p3_display_rate: p3DisplayRate {\\n      __typename\\n      amount\\n      amount_micros: amountMicros\\n      amount_formatted: amountFormatted\\n      is_micros_accuracy: isMicrosAccuracy\\n      currency\\n    }\\n  }\\n}\\n\\nfragment PdpSectionFragments on MerlinPdpSectionContainer {\\n  __typename\\n  id\\n  loggingData {\\n    __typename\\n    ...MerlinLoggingEventData\\n  }\\n  pluginPointId\\n  sectionId\\n  sectionContentStatus\\n  sectionComponentType\\n  sectionDependencies\\n  section {\\n    __typename\\n    ...AdminBannerSectionFragment\\n    ...HotelProfileSectionFragment\\n    ...HotelDescriptionSectionFragment\\n    ...SeoLinksSectionFragment\\n    ...ContactTripDesignerSectionFragment\\n    ...ReviewsEmptySectionFragment\\n    ...ServicesSectionFragment\\n    ...InterceptSurveySectionFragment\\n    ...LuxeHeroSectionFragment\\n    ...DescriptionSectionFragment\\n    ...MosaicTourPreviewSectionFragment\\n    ...AccessibilityFeaturesSectionFragment\\n    ...GeneralListContentSectionFragment\\n    ...HotelSingleRoomSectionFragment\\n    ...AvailabilityCalendarSectionFragment\\n    ...PoliciesSectionFragment\\n    ...HostProfileSectionFragment\\n    ...LocationPdpSectionFragment\\n    ...PdpAmenitiesSectionFragment\\n    ...HeroSectionFragment\\n    ...OverviewSectionFragment\\n    ...HighlightsSectionFragment\\n    ...LuxeDescriptionSectionFragment\\n    ...LuxeUnstructuredDescriptionSectionFragment\\n    ...LrEducationalModalFragment\\n    ...TitleSectionFragment\\n    ...NavMobileSectionFragment\\n    ...NavSectionFragment\\n    ...ReviewsSectionFragment\\n    ...SleepingArrangementSectionFragment\\n    ...HotelRoomsSectionFragment\\n    ...UgcTranslationSectionFragmentMerlin\\n    ...UnCMessageSectionFragment\\n    ...BookItSectionFragment\\n    ...BookItCalendarDrawerSectionFragment\\n    ...BookItCalendarSheetSectionFragment\\n    ...BookItFloatingFooterSectionFragment\\n    ...BookItNavSectionFragment\\n    ...BookItSidebarSectionFragment\\n    ...InsertSectionFragment\\n    ...CrossSellSectionFragment\\n    ...LuxeChatBubbleSectionFragment\\n    ...MerlinChinaHeroSectionFragment\\n    ...MerlinChinaReviewsSectionFragment\\n    ...MerlinChinaHostProfileSectionFragment\\n    ...MerlinChinaHostIntroSectionFragment\\n    ...MerlinChinaTieredPricingSectionFragment\\n    ...MerlinChinaTitleSectionFragment\\n    ...MerlinNavSectionFragment\\n    ...MerlinChinaAvailabilityCalendarSectionFragment\\n    ...MerlinChinaPoliciesSectionFragment\\n    ...MerlinChinaListingDetailSectionFragment\\n    ...MerlinChinaLocationInfoSectionFragment\\n    ...MerlinEducationFooterBannerSectionFragment\\n    ...MerlinBookItSectionFragment\\n    ...MerlinChinaBookItSectionFragment\\n    ...MerlinCrossSellSectionFragment\\n    ...MerlinReportToAirbnbSectionFragment\\n    ...MessageBannerSectionFragment\\n    ...MerlinChinaStpExplanationInfoSectionFragment\\n    ...MarqueeBookItFloatingFooterSectionFragment\\n    ...MarqueeBookItSidebarSectionFragment\\n    ...MarqueeBookItNavSectionFragment\\n  }\\n}\\n\\nfragment PdpSectionPlacementFragments on MerlinPdpSectionPlacement {\\n  __typename\\n  placement\\n  layout\\n  sectionDetails {\\n    __typename\\n    sectionId\\n    divider {\\n      __typename\\n      lineStyle\\n      lineWidth\\n    }\\n    border {\\n      __typename\\n      lineStyle\\n      shadow\\n      color\\n      hoverColor\\n      paddingPoints\\n      leftOnly\\n      rightOnly\\n      topRounded\\n      sides\\n      bottomRounded\\n    }\\n    topMarginPoints\\n    topPaddingPoints\\n    bottomPaddingPoints\\n    bottomMarginPoints\\n    backgroundColorNew {\\n      __typename\\n      hex\\n      dls19\\n    }\\n    horizontalPadding\\n    maxWidth\\n  }\\n  style {\\n    __typename\\n    topPaddingPoints\\n    bottomPaddingPoints\\n    border {\\n      __typename\\n      lineStyle\\n      shadow\\n      color\\n      hoverColor\\n      paddingPoints\\n      leftOnly\\n      rightOnly\\n      topRounded\\n      sides\\n      bottomRounded\\n    }\\n    span\\n  }\\n  formFactor\\n}\\n\\nfragment PoliciesSectionFragment on MerlinPoliciesSection {\\n  __typename\\n  title\\n  cancellationPolicyForDisplay {\\n    __typename\\n    title\\n    subtitles\\n    milestones {\\n      __typename\\n      color\\n      subtitles\\n      timelineLengthPercentage\\n      timelineWidthPercentage\\n      titles\\n      type\\n      isDated\\n      showToday\\n    }\\n    seeDetailsLink {\\n      __typename\\n      title\\n      anchor\\n    }\\n  }\\n  additionalHouseRules\\n  additionalHouseRulesTitle\\n  cancellationPolicyTitle\\n  houseRulesTitle\\n  listingExpectationsTitle\\n  safetyAndPropertyTitle\\n  houseRules {\\n    __typename\\n    icon\\n    title\\n  }\\n  listingExpectations {\\n    __typename\\n    icon\\n    subtitle\\n    title\\n  }\\n  previewSafetyAndProperties {\\n    __typename\\n    title\\n    icon\\n    learnMoreButton {\\n      __typename\\n      title\\n      anchor\\n      loggingEventData {\\n        __typename\\n        ...MerlinLoggingEventData\\n      }\\n      screenNavigation {\\n        __typename\\n        ... on MerlinBasicScreenNavigation {\\n          screenId\\n        }\\n      }\\n    }\\n  }\\n  safetyExpectationsAndAmenities {\\n    __typename\\n    title\\n    subtitle\\n    icon\\n    learnMoreButton {\\n      __typename\\n      title\\n      anchor\\n      loggingEventData {\\n        __typename\\n        ...MerlinLoggingEventData\\n      }\\n      screenNavigation {\\n        __typename\\n        ... on MerlinBasicScreenNavigation {\\n          screenId\\n        }\\n      }\\n    }\\n  }\\n  seeAllSafetyAndPropertyButton {\\n    __typename\\n    title\\n    loggingEventData {\\n      __typename\\n      ...MerlinLoggingEventData\\n    }\\n  }\\n  seeAllHouseRulesButton {\\n    __typename\\n    title\\n    loggingEventData {\\n      __typename\\n      ...MerlinLoggingEventData\\n    }\\n  }\\n  seeCancellationPolicyButton {\\n    __typename\\n    title\\n    loggingEventData {\\n      __typename\\n      ...MerlinLoggingEventData\\n    }\\n  }\\n  reportButton {\\n    __typename\\n    title\\n    loggingEventData {\\n      __typename\\n      ...MerlinLoggingEventData\\n    }\\n  }\\n  cleaningModal {\\n    __typename\\n    icon\\n    title\\n    description\\n    items {\\n      __typename\\n      icon\\n      title\\n      subtitle\\n    }\\n    learnMoreButton {\\n      __typename\\n      title\\n      anchor\\n      loggingEventData {\\n        __typename\\n        ...MerlinLoggingEventData\\n      }\\n    }\\n  }\\n  documentDisplay {\\n    __typename\\n    title\\n    subtitle\\n  }\\n  seeDocumentDisplayDetailsButton {\\n    __typename\\n    title\\n    loggingEventData {\\n      __typename\\n      ...MerlinLoggingEventData\\n    }\\n  }\\n  documentDisplayPictures {\\n    __typename\\n    title\\n    images {\\n      __typename\\n      ...HeroImageFragment\\n    }\\n  }\\n}\\n\\nfragment ReadMoreHtml on MerlinReadMoreHtml {\\n  __typename\\n  recommendedNumberOfLines\\n  htmlText\\n  readMoreButton {\\n    __typename\\n    title\\n    loggingEventData {\\n      __typename\\n      ...MerlinLoggingEventData\\n    }\\n  }\\n}\\n\\nfragment ReviewsEmptySectionFragment on MerlinReviewsEmptySection {\\n  __typename\\n  title\\n  items {\\n    __typename\\n    icon\\n    title\\n    loggingEventData {\\n      __typename\\n      ...MerlinLoggingEventData\\n    }\\n  }\\n}\\n\\nfragment ReviewsSectionFragment on MerlinReviewsSection {\\n  __typename\\n  title\\n  subtitle\\n  ratings {\\n    __typename\\n    localizedRating\\n    label\\n    accessibilityLabel\\n    percentage\\n  }\\n  overallCount\\n  overallRating\\n  seeAllReviewsButton {\\n    __typename\\n    title\\n    loggingEventData {\\n      __typename\\n      ...MerlinLoggingEventData\\n    }\\n  }\\n  seeMoreReviewsLoggingEventData {\\n    __typename\\n    ...MerlinLoggingEventData\\n  }\\n  reviewerProfilePhotoLoggingEventData {\\n    __typename\\n    ...MerlinLoggingEventData\\n  }\\n  translateReviewsLoggingEventData {\\n    __typename\\n    ...MerlinLoggingEventData\\n  }\\n  readMoreReviewLoggingEventData {\\n    __typename\\n    ...MerlinLoggingEventData\\n  }\\n  reviewImpressionLoggingEventData {\\n    __typename\\n    ...MerlinLoggingEventData\\n  }\\n  appreciationTags {\\n    __typename\\n    title\\n    subtitle\\n    icon\\n  }\\n  titleAccessibilityLabel\\n  previewHighlightTags {\\n    __typename\\n    accessibilityLabel\\n    count\\n    label\\n    highlightTag\\n  }\\n  allHighlightTags {\\n    __typename\\n    accessibilityLabel\\n    count\\n    label\\n    highlightTag\\n  }\\n  showMoreHighlightTags {\\n    __typename\\n    title\\n    loggingEventData {\\n      __typename\\n      ...MerlinLoggingEventData\\n    }\\n  }\\n  showFewerHighlightTags {\\n    __typename\\n    title\\n    loggingEventData {\\n      __typename\\n      ...MerlinLoggingEventData\\n    }\\n  }\\n}\\n\\nfragment RoomArrangementItemFragment on MerlinRoomArrangementItem {\\n  __typename\\n  title\\n  subtitle\\n  icons\\n  images {\\n    __typename\\n    ...PdpImageFragment\\n  }\\n}\\n\\nfragment SeePhotosButton on MerlinBasicListItem {\\n  __typename\\n  title\\n  loggingEventData {\\n    __typename\\n    ...MerlinLoggingEventData\\n  }\\n}\\n\\nfragment SeoLinksSectionFragment on MerlinSeoLinksSection {\\n  __typename\\n  title\\n  nearbyCities {\\n    __typename\\n    title\\n    anchor\\n  }\\n  otherPropertyTypesTitle\\n  otherPropertyTypes {\\n    __typename\\n    title\\n    anchor\\n  }\\n}\\n\\nfragment ServicesSectionFragment on MerlinServicesSection {\\n  __typename\\n  contactDesignerButton {\\n    __typename\\n    title\\n    anchor\\n    loggingEventData {\\n      __typename\\n      ...MerlinLoggingEventData\\n    }\\n  }\\n  contactDesignerTitle\\n  title\\n  subtitle\\n  services {\\n    __typename\\n    image {\\n      __typename\\n      ...PdpImageFragment\\n    }\\n    title\\n  }\\n}\\n\\nfragment ShareSaveButton on MerlinBasicListItem {\\n  __typename\\n  title\\n  subtitle\\n  loggingEventData {\\n    __typename\\n    ...MerlinLoggingEventData\\n  }\\n}\\n\\nfragment SharingConfigFragment on MerlinSharingConfig {\\n  __typename\\n  title\\n  propertyType\\n  location\\n  personCapacity\\n  imageUrl\\n  pdpLink\\n  reviewCount\\n  starRating\\n}\\n\\nfragment SleepingArrangementSectionFragment on MerlinSleepingArrangementSection {\\n  __typename\\n  title\\n  arrangementDetails {\\n    __typename\\n    ...RoomArrangementItemFragment\\n  }\\n}\\n\\nfragment TitleSectionFragment on MerlinTitleSection {\\n  __typename\\n  title\\n  logo\\n  overviewItems {\\n    __typename\\n    accessibilityLabel\\n    title\\n    subtitle\\n    icon\\n    anchor\\n    loggingEventData {\\n      __typename\\n      ...MerlinLoggingEventData\\n    }\\n    scrollId\\n    action {\\n      __typename\\n      ... on MerlinNavigateToMap {\\n        screenId\\n      }\\n    }\\n  }\\n  saveButton {\\n    __typename\\n    ...ShareSaveButton\\n  }\\n  unsaveButton {\\n    __typename\\n    ...ShareSaveButton\\n  }\\n  shareButton {\\n    __typename\\n    ...ShareSaveButton\\n  }\\n  logoAccessibilityLabel\\n  shareSave {\\n    __typename\\n    ...MerlinShareSaveFragment\\n  }\\n}\\n\\nfragment UgcTranslationButton on MerlinUgcTranslationButton {\\n  __typename\\n  ctaText\\n  icon\\n  loggingEventData {\\n    __typename\\n    ...MerlinLoggingEventData\\n  }\\n  subtitle\\n  title\\n  translationState\\n}\\n\\nfragment UgcTranslationSectionFragmentMerlin on MerlinUgcTranslationSection {\\n  __typename\\n  ugcTranslationButton {\\n    __typename\\n    ...UgcTranslationButton\\n  }\\n}\\n\\nfragment UnCMessageSectionFragment on MerlinUrgencyCommitmentSection {\\n  __typename\\n  inlineTitle\\n  rightIcon\\n  messageData {\\n    __typename\\n    messageType\\n    message {\\n      __typename\\n      body\\n      contextualMessage\\n      ctaText\\n      ctaUrl\\n      headline\\n      icon\\n      iconEnum\\n      iconUrl\\n    }\\n    action {\\n      __typename\\n      confirmationMessageType\\n      label\\n      payload {\\n        __typename\\n        checkIn\\n        checkOut\\n      }\\n      type\\n    }\\n  }\\n}","variables":%s}'
        % (json.dumps(req),)
    )
    headers = {
        "accept": "*/*",
        "accept-encoding": "gzip, deflate, br",
        "content-type": "application/json",
        "origin": "https://www.airbnb.com",
        "x-airbnb-api-key": api_key,
    }

    return requests.request("POST", url, headers=headers, data=payload)


def get_value_from_path(response, path):
    path_pieces = path.split(".")
    query = response.json()
    for piece in path_pieces:
        if "[" in piece:
            m = re.fullmatch(
                r"(?P<arr>\w+)\[(?P<key>\w+) (?P<op>(==|contains)) (?P<value>.*)\](?P<optional>\??)",
                piece,
            )
            assert m is not None
            arr, key, op, value, optional = m.group(
                "arr", "key", "op", "value", "optional"
            )
            value = json.loads(value)
            op_func = {
                "==": operator.eq,
                "contains": operator.contains,
            }[op]
            vals = [e for e in query[arr] if op_func(e[key], value)]
            if optional and not vals:
                return None
            assert len(vals) == 1
            query = vals[0]
        else:
            if query is None:
                print(response.json(), file=sys.stderr)
                raise ValueError(
                    f"Failed to fetch piece '{piece}' of path '{path}'"
                )
            query = query[piece]
    return query


@dataclasses.dataclass(frozen=True)
class AirbnbAspect:
    name: str
    path: str
    dtype: Type
    postprocessor: Callable[[Any], Any] = lambda a: a

    def request_contains(self, sections: List[str]) -> bool:
        return "[" not in self.path or any(
            section in self.path for section in sections
        )


ASPECTS = (
    AirbnbAspect(
        name="Name",
        path="data.merlin.pdpSections.metadata.sharingConfig.title",
        dtype=str,
    ),
    AirbnbAspect(
        name="List Price",
        path='data.merlin.pdpSections.sections[sectionId == "BOOK_IT_SIDEBAR"].section.price.total.amount',
        dtype=float,
    ),
    AirbnbAspect(
        name="Bedrooms",
        path='data.merlin.pdpSections.sections[sectionId == "OVERVIEW_DEFAULT"].section.detailItems[title contains "bedroom"].title',
        dtype=int,
        postprocessor=lambda a: a.split()[0],
    ),
    AirbnbAspect(
        name="Bathrooms",
        path='data.merlin.pdpSections.sections[sectionId == "OVERVIEW_DEFAULT"].section.detailItems[title contains "bath"].title',
        dtype=float,
        postprocessor=lambda a: float(a.split()[0]),
    ),
    AirbnbAspect(
        name="Unavailable",
        path='data.merlin.pdpSections.sections[sectionId == "BOOK_IT_SIDEBAR"].section.available',
        dtype=bool,
        postprocessor=lambda a: not a,
    ),
    AirbnbAspect(
        name="Pet friendly",
        path='data.merlin.pdpSections.sections[sectionId == "POLICIES_DEFAULT"].section.houseRules[title == "Pets are allowed"]?.title',
        dtype=bool,
        postprocessor=bool,
    ),
    AirbnbAspect(
        name="Laundry",
        path='data.merlin.pdpSections.sections[sectionId == "AMENITIES_DEFAULT"].section.seeAllAmenitiesGroups[title == "Bedroom and laundry"]?.amenities[title == "Dryer"]?.available',
        dtype=bool,
        postprocessor=bool,
    ),
    AirbnbAspect(
        name="Dishwasher",
        path='data.merlin.pdpSections.sections[sectionId == "AMENITIES_DEFAULT"].section.seeAllAmenitiesGroups[title == "Kitchen and dining"]?.amenities[title == "Dishwasher"]?.available',
        dtype=bool,
        postprocessor=bool,
    ),
    AirbnbAspect(
        name="Superhost",
        path="data.merlin.pdpSections.metadata.loggingContext.eventDataLogging.isSuperhost",
        dtype=bool,
        postprocessor=bool,
    ),
    AirbnbAspect(
        name="Hot Tub",
        path='data.merlin.pdpSections.sections[sectionId == "AMENITIES_DEFAULT"].section.seeAllAmenitiesGroups[title == "Parking and facilities"]?.amenities[title == "Hot tub"]?.available',
        dtype=bool,
        postprocessor=bool,
    ),
    AirbnbAspect(
        name="Pool",
        path='data.merlin.pdpSections.sections[sectionId == "AMENITIES_DEFAULT"].section.seeAllAmenitiesGroups[title == "Parking and facilities"]?.amenities[title == "Pool"]?.available',
        dtype=bool,
        postprocessor=bool,
    ),
    AirbnbAspect(
        name="Latitude",
        path='data.merlin.pdpSections.sections[sectionId == "LOCATION_DEFAULT"].section.lat',
        dtype=float,
    ),
    AirbnbAspect(
        name="Longitude",
        path='data.merlin.pdpSections.sections[sectionId == "LOCATION_DEFAULT"].section.lng',
        dtype=float,
    ),
)


def get_location(lat, lng):
    geolocator = geopy.ArcGIS(user_agent=USER_AGENT)
    location = geolocator.reverse((lat, lng))
    return {
        "Zipcode": location.raw["Postal"],
        "City": f"{location.raw['City']}, {location.raw['Region']}",
    }


def get_instacart_availability(zipcode):
    url = f"https://www.instacart.com/v3/dynamic_data/authenticate/postal_code_check?postal_code={zipcode}&location_type=postal_code"
    headers = {
        "content-type": "application/json",
        "user-agent": USER_AGENT,
    }
    response = requests.request("GET", url, headers=headers)
    return get_value_from_path(
        response,
        "meta.triggered_action.data.container_tracking_params.zip_active",
    )


def get_weather(latitude, longitude, check_in, check_out, api_key):
    check_in_date = datetime.date(*map(int, check_in.split("-")))
    check_out_date = datetime.date(*map(int, check_out.split("-")))
    avg_highs, avg_lows, means = [], [], []
    start = check_in_date
    while start <= check_out_date:
        params = {
            "geocode": f"{latitude},{longitude}",
            "startDay": f"{check_in_date.day}",
            "startMonth": f"{check_in_date.month}",
            "units": "e",
            "format": "json",
            "apiKey": api_key,
        }
        url = (
            "https://api.weather.com/v3/wx/almanac/daily/45day?"
            + urllib.parse.urlencode(params)
        )
        response = requests.request("GET", url)
        response_json = response.json()
        assert (
            len(response_json["almanacInterval"]) == 45
        ), f"Weather API request failed: {response_json}"
        avg_lows += response_json["temperatureAverageMin"]
        avg_highs += response_json["temperatureAverageMax"]
        means += response_json["temperatureMean"]
        start += datetime.timedelta(days=45)
    total_days = (check_out_date - check_in_date).days + 1
    avg_lows = avg_lows[:total_days]
    avg_highs = avg_highs[:total_days]
    means = means[:total_days]
    return {
        "Temperature (Avg High)": round(sum(avg_highs) / len(avg_highs), 1),
        "Temperature (Avg Low)": round(sum(avg_lows) / len(avg_lows), 1),
        "Temperature (Mean)": round(sum(means) / len(means), 1),
    }


def get_properties(room_id, check_in, check_out, number_guests, api_key):
    def properties_for_sections(sections):
        response = get_response_from_section(
            room_id,
            check_in,
            check_out,
            number_guests,
            sections,
            api_key,
        )
        return {
            aspect.name: aspect.postprocessor(
                get_value_from_path(response, aspect.path)
            )
            for aspect in ASPECTS
            if aspect.request_contains(sections)
        }

    return {
        **properties_for_sections(["OVERVIEW_DEFAULT"]),
        **properties_for_sections(["POLICIES_DEFAULT"]),
        **properties_for_sections(["AMENITIES_DEFAULT"]),
        **properties_for_sections(["BOOK_IT_SIDEBAR"]),
        **properties_for_sections(["LOCATION_DEFAULT"]),
        "Link": f"https://www.airbnb.com/rooms/{room_id}?check_in={check_in}&check_out={check_out}&guests={number_guests}&adults={number_guests}",
    }


def get_airbnb_data(
    airbnb_api_key,
    weather_api_key,
    number_guests=None,
    room_id=None,
    url=None,
    check_in=None,
    check_out=None,
):
    if url:
        pieces = urllib.parse.urlsplit(url)
        room_id = pieces.path.split("/")[-1]
        params = urllib.parse.parse_qs(pieces.query)
        # If the check_in/out query param is present in the url and wasn't
        # provided as an argument, set the arg value to the one in the url.
        if "check_in" in params and not check_in:
            check_in = params["check_in"][0]
        if "check_out" in params and not check_out:
            check_out = params["check_out"][0]
        if "guests" in params and not number_guests:
            number_guests = params["guests"][0]
    properties = get_properties(
        room_id, check_in, check_out, number_guests, airbnb_api_key
    )
    properties.update(
        get_location(properties["Latitude"], properties["Longitude"])
    )
    properties["One Guest Price"] = get_one_guest_price(
        room_id, check_in, check_out, airbnb_api_key
    )
    properties["Instacart"] = get_instacart_availability(properties["Zipcode"])
    properties.update(
        get_weather(
            properties["Latitude"],
            properties["Longitude"],
            check_in,
            check_out,
            weather_api_key,
        )
    )
    labels = [
        "City",
        "Name",
        "Link",
        "Contacted",
        "Unavailable",
        "List Price",
        "Negotiated $$",
        "Bedrooms",
        "Bathrooms",
        "Instacart",
        "Pet friendly",
        "Laundry",
        "WiFi speed",
        "Dishwasher",
        "Superhost",
        "Hot Tub",
        "Pool",
        "Big living room",
        "Outdoor working space",
        "Temperature (Avg High)",
        "Temperature (Avg Low)",
        "Temperature (Mean)",
        "One Guest Price",
        "Notes",
    ]
    values = [properties.get(label, "") for label in labels]
    return values


if __name__ == "__main__":

    parser = argparse.ArgumentParser(
        description="Enter either an Airbnb URL or a room id, number of guests, check-in, and check-out date to pull data about an Airbnb listing."
    )
    parser.add_argument(
        "--airbnb-api-key", required=True, help="API Key for Airbnb"
    )
    parser.add_argument(
        "--weather-api-key", required=True, help="API Key for weather.com"
    )
    parser.add_argument(
        "--check-in",
        help="Check out date of the form YYYY-MM-DD",
    )
    parser.add_argument(
        "--check-out",
        help="Check out date of the form YYYY-MM-DD",
    )
    parser.add_argument(
        "--guests",
        help="Number of guests.",
    )
    id_group = parser.add_mutually_exclusive_group()
    id_group.add_argument("--id", help="The numeric ID of the Airbnb listing")
    id_group.add_argument(
        "--url",
        help="Airbnb room URL. If the URI contains the check_in and/or check_out query params, these will be used as the default values for those arguments.",
    )

    args = parser.parse_args()
    values = get_airbnb_data(
        args.airbnb_api_key,
        args.weather_api_key,
        args.guests,
        args.id,
        args.url,
        args.check_in,
        args.check_out,
    )
    import csv
    import sys

    csv.writer(sys.stdout, delimiter="\t").writerow(values)
